TODO
----


Central service for mesh management and monitoring (MessagingMeshCoordinator)
-----------------------------------------------------------------------------
- Gateways can register with this
  - To note that they are managing a service
  - To discover other Gateways managing the service
  - ie, to discover the mesh rather than using config

- Gateways can report statistics

- What should this central service be called?
  - MeshManager
  - MeshMonitor
  - MeshCoordinator
  - As above but MessagingMeshCoordinator (etc)

- I quite like MessagingMeshCoordinator


How does the Gateway talk to the Coordinator?
---------------------------------------------
- The gateway talks to the coodinator to:
  - Manage / discover the mesh
  - Send statistics

- The gateway may be runnning multiple services
  - Each of these needs to manage its mesh
  - Each of these needs to send statistics

- Options
  a. One connection to the coordinator per service
  b. One connection to the coordinator shared by all the services

- Option b seems better
  - But we need to be careful to marshal events to the service's UV thread
  - (Which should be fairly easy to do.)

- IDEA: Let's say that the MeshManager connects to the Coordinator using the client-style Connection
  - Set to call back on the connection's own thread (ie, PMQ not needed)


  Gateway config to use the Coordinator
  -------------------------------------
  - You can optionally set meshes to be managed by the Coordinator

  - The Coordinator should be optional
    - For mesh management and for statistics
    - ie, You do no need to run it


What data / stats do we report to the coordinator?
--------------------------------------------------
- Stats are reported by gateways

- We do not want stats to be too intrusive into performance 
  - At least in normal operation
  - It could be that the UI and coordinator can request more detailed stats from a gateway when needed

- How intrusive is it to publish more detailed stats all the time?
  - We likely want a mechanism to do this anyway (even if only on demand)
  - So we do want a "full stats" mode
  - Even if we might report cut down stats normally

- I wonder if even "full stats" should be cut down to some extent
  - For example, say we have 1M subscriptions
  - We would likely not want to report on all of them
  - So if we report on subscriptions, it could be top 10 (for example)
    - Or do I mean publications?

- Basic stats (and metadata)
  - Service name
  - Gateway hostname
  - Gateway port
  - Total messages / second
  - Total Mb/s

- Enhanced status
  - Basic stats
  - Top ten msg/sec, Mb/s by subject

- "By subject" means subject received by the gateway from local clients

- Q: How do we do the top ten?
  - What if the top messages/sec is for different subjects than the top Mb/s?
  - ie, some small fast subjects vs some large slower subjects
  - A: We do the top ten for both and merge the two collections

- Q: Where / how do we collect the stats?
  - We can collect stats about messages in ServiceManager::onMessage
  - We should only note stats for messages from local clients (ie, not from mesh peers)

- Q: Do we want to note stats for messages relayed from mesh peers as well?
  - That could be useful to see
  - In case (somehow) processing messages from mesh peers is overaloading the system
  - So maybe it would be good to have top-level stats for peer traffic, ie msg/sec and Mb/s

- IDEA: As an initial dev thing we could log the stats every interval (eg every 2 sec)
  - Before doing the work to send them to the gateway

- Stats format
  - Time string (UTC)
  - Messages/second
  - Mb/second

What subject does the gateway use when publishing stats?
--------------------------------------------------------
- Should it be a 'reserved' subject?
  - Starting with an underscore
  - Let's say Yes

- "_GATEWAY.STATS"

- Should we publish all stats on the same subject?
  - Maybe No
  - We might want an MMListen app
  - So with this it would be good to be able to listen to stats from a specific service and gateway

- _GATEWAY.STATS.[gateway-name].[service-name]

  













